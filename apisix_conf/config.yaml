apisix:
  node_listen: 9080
  enable_ipv6: false
  enable_admin: true
  admin_key:
    - name: admin
      key: edd1c9f034335f136f87ad84b625c8f1
      role: admin

  proxy:
    proxy_read_timeout: 1200
    proxy_send_timeout: 1200
    proxy_connect_timeout: 10

deployment:
  role: traditional
  role_traditional:
    config_provider: etcd
  admin:
    allow_admin:
      - 0.0.0.0/0
    admin_listen:
      port: 9180
  etcd:
    host:
      - "http://dx-etcd:2379"
    prefix: "/apisix"
    timeout: 30

# [NEW - MONITORING] Enable Prometheus metrics endpoint
# Access at http://localhost:9091/apisix/prometheus/metrics
plugin_attr:
  prometheus:
    enable_export_server: true
    export_addr:
      ip: 0.0.0.0
      port: 9091

# [NEW - LOGGING + SESSION TRACKING]
nginx_config:
  http:
    access_log_format: '"$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $upstream_addr $upstream_status $upstream_response_time'
  # [NEW] Inject custom shared dict for session tracking directly into nginx.conf
  # Equivalent of HAProxy's stick-table (10MB in-memory)
  http_configuration_snippet: |
    lua_shared_dict plugin-session-tracker 10m;
